# Visual HTML Builder

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

A modern visual HTML builder for browsers. A lightweight TypeScript library that provides intuitive drag-and-drop HTML editing, complete style isolation, and real-time preview functionality.

## üöÄ Quick Start

### Installation

```bash
# Install via npm
npm install visual-html-builder

# Or via yarn
yarn add visual-html-builder

# Via CDN (IIFE version)
<script src="https://unpkg.com/visual-html-builder@latest/dist/index.iife.js"></script>
```

### Development/Contribution Setup

```bash
# Clone the project
git clone https://github.com/naoki85/visual-html-builder.git
cd visual-html-builder

# Install dependencies
npm install
```

### Basic Usage

```typescript
import VisualHtmlBuilder from 'visual-html-builder';
// Import CSS as well
import 'visual-html-builder/dist/index.css';

// Prepare HTML container
// <div id="editor-container"></div>

// Basic initialization
const editor = new VisualHtmlBuilder('editor-container', {
  theme: 'default',
  enabledElements: ['title', 'text', 'image', 'list']
});
```

### CDN Usage

```html
<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="https://unpkg.com/visual-html-builder@latest/dist/index.css">
</head>
<body>
  <div id="editor-container"></div>
  
  <script src="https://unpkg.com/visual-html-builder@latest/dist/index.iife.js"></script>
  <script>
    const editor = new window.VisualHtmlBuilder('editor-container', {
      enabledElements: ['title', 'text', 'image', 'list']
    });
  </script>
</body>
</html>
```

### Advanced Configuration

```typescript
// Full customization example
const editor = new VisualHtmlBuilder('editor-container', {
  theme: 'default',
  enabledElements: ['title', 'text', 'image', 'list'],
  iframePreviewOptions: {
    enableDragDrop: true,
    enableElementSelection: true,
    customStyles: `
      body { 
        font-family: 'Helvetica Neue', sans-serif;
        background: #f5f5f5; 
      }
    `
  },
  htmlTemplate: {
    doctype: '<!DOCTYPE html>',
    htmlAttributes: { lang: 'en' },
    head: {
      title: 'Generated Page',
      meta: [
        { charset: 'UTF-8' },
        { name: 'viewport', content: 'width=device-width, initial-scale=1.0' },
        { name: 'description', content: 'Generated by Visual HTML Builder' }
      ],
      links: [
        { rel: 'stylesheet', href: 'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap' }
      ]
    },
    bodyAttributes: { class: 'generated-content' }
  }
});
```

### HTML Retrieval and API

```typescript
// Body HTML only (existing API - maintains backward compatibility)
const bodyHTML = editor.getHTML();

// Complete HTML document (new API)
const fullHTML = editor.getFullHTML();

// Template management
const currentTemplate = editor.getHTMLTemplate();
editor.updateHTMLTemplate({
  head: {
    title: 'Updated Title'
  }
});

// Element management
const elements = editor.getElements();
editor.setElements([
  { id: 1, type: 'title', props: { text: 'Welcome!', level: 1 }}
]);

// Adding custom elements
editor.registerElementType('custom-button', {
  name: 'Button',
  icon: 'üî≤',
  defaultProps: { text: 'Click Me', color: '#007bff' },
  render: (props) => `<button style="background-color: ${props.color};">${props.text}</button>`,
  renderEditor: (props) => `
    <div class="property-group">
      <label>Button Text:</label>
      <input type="text" value="${props.text}" 
             onchange="window.htmlEditor.updateProperty('text', this.value)">
    </div>
    <div class="property-group">
      <label>Color:</label>
      <input type="color" value="${props.color}" 
             onchange="window.htmlEditor.updateProperty('color', this.value)">
    </div>
  `,
  validate: (props) => props.text.trim() ? null : 'Button text is required'
});
```

## üì¶ Development

```bash
# Install dependencies
npm install

# Start development server
npm run dev

# Build
npm run build

# Linting
npm run lint

# Code formatting
npm run format
```

## üß™ Testing

This project includes a comprehensive test suite using **Vitest**.

### Running Tests

```bash
# Basic test run (watch mode)
npm run test

# One-shot execution
npm run test:run

# Open test UI
npm run test:ui

# Watch mode (monitor file changes)
npm run test:watch

# Generate coverage report
npm run test:coverage
```

### Testing Tech Stack

- **Vitest 3.2.4**: Fast test runner (Jest API compatible)
- **jsdom**: DOM environment simulation
- **c8**: Coverage report generation
- **TypeScript**: Complete type safety

## üèóÔ∏è Architecture

### Core Class
- **VisualHtmlBuilder** (`src/VisualHtmlBuilder.ts`): Main class (478 lines)
  - Handles DOM management, event processing, element selection, and preview updates
  - Combines various helpers to provide functionality

### Helper Module Structure
```
src/helpers/
‚îú‚îÄ‚îÄ HTMLTemplateHelper.ts     # 279 lines - Complete HTML document generation
‚îú‚îÄ‚îÄ IframePreviewHelper.ts    # 443 lines - Style isolation preview functionality
‚îú‚îÄ‚îÄ ElementTypesHelper.ts     # 196 lines - HTML element type definition & management
‚îú‚îÄ‚îÄ StylesHelper.ts           # 580 lines - CSS management & injection
‚îú‚îÄ‚îÄ NotificationHelper.ts     # 266 lines - Notification system
‚îú‚îÄ‚îÄ DragDropHelper.ts         # 297 lines - Drag & drop functionality
‚îî‚îÄ‚îÄ UtilityHelpers.ts         # 29 lines - General utilities
```

## üîß Tech Stack

### Development & Build
- **TypeScript 5.8.3**: Strict type checking, ES2020 target
- **Vite 7.0.4**: Fast build tool, ES Modules + UMD + IIFE output
- **ESLint + Prettier**: Code quality management, unified formatting

### Testing
- **Vitest 3.2.4**: Fast test runner, Jest API compatible
- **jsdom**: DOM environment simulation
- **c8**: Coverage report generation

### Runtime Environment
- **Node.js**: >=18.0.0
- **npm**: >=8.0.0

## üìã Use Cases

### üéØ Intended Usage Scenarios

- **HTML Editor in Web Applications**: CMS, blog editors, email creation features
- **Landing Page Builders**: Code-free page creation tools
- **Educational Tools**: Visual editors for HTML learning
- **Prototyping**: Mockup creation for designers and planners

### üõ†Ô∏è Technical Features

- **Framework Agnostic**: Can be combined with any framework like React, Vue, Angular
- **Modular Design**: Select and use only the features you need
- **Type Safety**: Complete type support with TypeScript
- **Lightweight**: Minimal dependencies with 44kB lightweight implementation

## üß© Custom Element Development

### ElementType Interface

```typescript
interface ElementType {
  name: string;                    // Display name
  icon: string;                    // Icon (emoji or text)
  defaultProps: Record<string, any>; // Default properties
  render: (props: Record<string, any>) => string;        // HTML generation
  renderEditor: (props: Record<string, any>, onChange?: (key: string, value: any) => void) => string; // Property editor
  validate: (props: Record<string, any>) => string | null; // Validation
}
```

### Basic Custom Element Example

```typescript
// Simple button element
editor.registerElementType('custom-button', {
  name: 'Button',
  icon: 'üî≤',
  defaultProps: { 
    text: 'Click Me', 
    color: '#007bff', 
    size: 'medium' 
  },
  render: (props) => 
    `<button style="background-color: ${props.color}; padding: ${props.size === 'large' ? '12px 24px' : '8px 16px'};">${props.text}</button>`,
  renderEditor: (props) => `
    <div class="property-group">
      <label>Button Text:</label>
      <input type="text" value="${props.text}" 
             onchange="window.htmlEditor.updateProperty('text', this.value)">
    </div>
    <div class="property-group">
      <label>Color:</label>
      <input type="color" value="${props.color}" 
             onchange="window.htmlEditor.updateProperty('color', this.value)">
    </div>
    <div class="property-group">
      <label>Size:</label>
      <select onchange="window.htmlEditor.updateProperty('size', this.value)">
        <option value="small" ${props.size === 'small' ? 'selected' : ''}>Small</option>
        <option value="medium" ${props.size === 'medium' ? 'selected' : ''}>Medium</option>
        <option value="large" ${props.size === 'large' ? 'selected' : ''}>Large</option>
      </select>
    </div>
  `,
  validate: (props) => props.text.trim() ? null : 'Button text is required'
});
```

### Complex Custom Element Example

```typescript
// Video player element
editor.registerElementType('video-player', {
  name: 'Video Player',
  icon: 'üìπ',
  defaultProps: {
    src: '',
    poster: '',
    controls: true,
    autoplay: false,
    width: 640,
    height: 360
  },
  render: (props) => {
    const attributes = [
      `src="${UtilityHelpers.escapeHtml(props.src)}"`,
      `width="${props.width}"`,
      `height="${props.height}"`,
      props.poster ? `poster="${UtilityHelpers.escapeHtml(props.poster)}"` : '',
      props.controls ? 'controls' : '',
      props.autoplay ? 'autoplay' : ''
    ].filter(Boolean).join(' ');
    
    return `<video ${attributes}>Your browser does not support the video tag.</video>`;
  },
  renderEditor: (props) => `
    <div class="property-group">
      <label>Video URL:</label>
      <input type="url" value="${props.src}" 
             onchange="window.htmlEditor.updateProperty('src', this.value)">
    </div>
    <div class="property-group">
      <label>Poster Image:</label>
      <input type="url" value="${props.poster}" 
             onchange="window.htmlEditor.updateProperty('poster', this.value)">
    </div>
    <div class="property-group">
      <label>
        <input type="checkbox" ${props.controls ? 'checked' : ''} 
               onchange="window.htmlEditor.updateProperty('controls', this.checked)">
        Show Controls
      </label>
    </div>
    <div class="property-group">
      <label>
        <input type="checkbox" ${props.autoplay ? 'checked' : ''} 
               onchange="window.htmlEditor.updateProperty('autoplay', this.checked)">
        Autoplay
      </label>
    </div>
    <div class="property-group">
      <label>Width:</label>
      <input type="number" value="${props.width}" min="1" 
             onchange="window.htmlEditor.updateProperty('width', parseInt(this.value))">
    </div>
    <div class="property-group">
      <label>Height:</label>
      <input type="number" value="${props.height}" min="1" 
             onchange="window.htmlEditor.updateProperty('height', parseInt(this.value))">
    </div>
  `,
  validate: (props) => {
    if (!props.src.trim()) return 'Video URL is required';
    if (!UtilityHelpers.isValidUrl(props.src)) return 'Please enter a valid video URL';
    return null;
  }
});
```

### Usage Notes

1. **Security**: Prevent XSS with `UtilityHelpers.escapeHtml()`
2. **Element Activation**: Need to add custom element name to `enabledElements` array
3. **Property Updates**: Use `window.htmlEditor.updateProperty()`
4. **Validation**: Input validation with appropriate error messages
5. **Accessibility**: Consider HTML structure and aria attributes

---

## üìÑ License

MIT License - See [LICENSE](LICENSE) file for details

---

### üìß Contact

- **GitHub Issues**: [Bug reports & feature requests](https://github.com/naoki85/visual-html-builder/issues)
